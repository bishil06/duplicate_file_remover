# 중복파일 제거 애플리케이션

node js 를 사용해서 만들어진 중복파일 제거 애플리케이션 입니다.

이 프로그램의 프로세스는 크게 3단계로 구분됩니다.

1. 입력: 검사할 경로를 입력받습니다.
2. 분석: 입력된 경로를 검사하여 중복파일을 찾아냅니다.
3. 복사: 새로운 경로로 중복된 파일들을 제외하여 복사합니다.

## 1. 입력 프로세스

(...toInspectDirs, destDir)  
하나 이상의 검사할 폴더들과 중복이 제거된 파일들을 복사할 폴더를 입력합니다.  
함수는 검사할 폴더들이 유효하고 읽을수 있는지, 복사할 폴더가 유효하고 쓸수 있는지 검사합니다.  
폴더안에 폴더가 더욱더 들어있는 경우 옵션으로 내부까지 검사할지 결정합니다.  
모두 검증이 되었다면 다음 프로세스로 넘어갑니다.

## 2. 분석 프로세스

입력된 검사할 폴더들 안에 있는 모든 파일들의 리스트를 불러온다.  
[a, b, c, d, e, ...]

### 중복 검사 프로세스

1. 파일 사이즈 측정
2. 사이즈가 같다면 hash 값으로 비교

## 3. 복사 프로세스

중복이 제거된 파일 리스트를 하나씩 꺼내서 목적지(중복이 제거된 파일들을 저장할 폴더)에 복사한다.

# 구현 목표

1. 자바스크립트의 비동기 특성을 이용해서 위 프로세스를 비동기적으로 실행할 것이다.
2. 각 프로세스별로 에러처리를 Promise를 활용하여 해결한다.
   외부적 요인으로 에러가 발생할수 있는 부분(네트워크, 파일)은 Promise로 감싼다
3. 되도록 함수형 프로그래밍 기법을 활용해서 함수와 함수의 조합으로 문제를 해결한다.

# 현재 하고있는 작업들

- 경로가 디렉토리인지 검사 -> 완료
- 모든에러를 출력하고 관리할 함수 만들기 -> 임시완료
- 경로가 읽을수 있는 경로인지 확인하는 함수 만들기 -> 완료
- 경로가 파일인지 디렉토리인지 구분하는 함수 만들기 -> 진행중(기존함수를 수정한다) -> 각각구현
- 파일과 디렉토리를 관리할 모델과 중복제거된 파일 리스트 관리할 모델을 추가했다. -> 완료
- 기존 함수들의 에러처리를 좀더 간략화 하면서 에러를 구분하기 쉽도록 재설계했다. -> 프로미즈로 wrap
- 폴더를 열어서 하나씩 폴더의 요소를 가져오는 getDirent 함수를 추가
- Dir_Model 에 폴더 내부의 파일들의 목록을 읽어오는 readDir 메서드를 추가했다.
- Dir_Model 에 모든 파일들의 리스트를 가져오는 getAllFileList 메서드를 추가했다.
- Dir_Model 에 모든 폴더객체들의 리스트를 가져오는 getAllDirList 메서드를 추가했다.
- test 디렉토리 안에 함수 테스트용 파일과 디렉토리들을 추가했다.
- 중복이제거된파일리스트 모델 만들기 -> 진행중
- 중복 된 파일 비교를 위해 파일모델에 size와 hash 값 비교함수 추가
- 중복을 제거해서 파일리스트에 추가하는 함수가 동시에 실행될경우 모든 파일들이 아무것도 추가되지 않은 빈배열과 동시에 비교되어서 모든 파일들이 입력되는 문제가 발생함 -> 어떻게 해결해야할지 고민중

# 모델

- Dir_Model
  디렉토리 관리 모델  
  RootDir 이라는 객체를 생성후 그 밑에 subDirs 로 추가되어 tree 구조로 관리가 된다.  
  각 Dir 객체는 하위 Dir 객체를 생성하여 추가 할 수 있고 관리해야 한다.  
  Dir 객체는 dir path 를 받으면 해당 path 가 디렉토리이고 읽을수 있는지 검사한다.  
  각 Dir 객체는 file path 를 입력받아 File 객체를 생성하여 fieList에 추가할 수 있고 관리해야 한다.

* File_Model
  파일 관리 모델  
  Dir 객체에 의해서 생성 관리된다.  
  File 객체는 file path 를 받아 생성될때 path 가 파일이고 읽을수 있는지 검사한다.  
  File 객체는 생성될때 파일의 stats를 받아서 객체의 정보에 추가되고 파일의 사이즈를 구할수 있어야 한다.  
  또한 파일의 이름 과 hash 도 얻을수 있어야 한다.

* NoDupFileList_Model
  중복 제거된 파일 모델

# 메모

- 폴더가 아닌 심볼릭 링크는 어떻게 처리할것인가?
  옵션으로 내부폴더로 인식할경우 stat, 아닐경우 lstat
- 프로미즈 체인에서 도중에 에러가 발생할경우 뒤 예약된 함수들을 실행하지 않도록 하는 방법 찾기 -> 찾는중
- 파일, 디렉토리, 중복제거된파일들 관리를 어떻게 해야 할까?
- 파일의 목록을 읽어올때 비동기적으로 읽어오려면 어떻게 해야할까?
- Dir 모델에서 subDir을 추가하고 수동으로 readDir을 실행하도록 할지 추가되면 바로 readDir을 하도록 할지 고민중 -> 추후 기능확장을 생각하면 분리해두는것이 더 나을것으로 보인다.

# 해결해야할 문제

- 중복제거된파일리스트를 비동기로 만들기 위해서는 어떻게 해야할까?
- 빈디렉토리가 git에 추가되지 않아서 테스트 코드에서 에러가 발생 -> .keep 으로 해결

# 추가로 넣고싶은 기능들

- 폴더를 입력할때 하위폴더 포함할지 안할지 선택하는 기능
- 입력된 폴더들이 서로 중복이 있다면 표시해주고 수정하도록 권해주는 기능
- 실행결과를 gui로 실시간으로 확인하는 기능 - 실행은 병렬로 동시에 실행
- 파일리스트를 가져올때부터 모든 프로세스를 병렬로 실행
